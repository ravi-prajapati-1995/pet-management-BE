-- Sequences
CREATE SEQUENCE owner_SEQ START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE pet_SEQ START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE roles_SEQ START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE vaccine_SEQ START WITH 1 INCREMENT BY 50;

-- Tables
CREATE TABLE app_user (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    username VARCHAR(255),
    password VARCHAR(255),
    PRIMARY KEY (id)
);

CREATE TABLE owner (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(255),
    phone_number VARCHAR(255),
    PRIMARY KEY (id)
);

CREATE TABLE pet (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    age INTEGER NOT NULL,
    owner_id BIGINT,
    name VARCHAR(255),
    PRIMARY KEY (id)
);

CREATE TABLE roles (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(255),
    PRIMARY KEY (id)
);

CREATE TABLE user_roles (
    role_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    PRIMARY KEY (role_id, user_id)
);

CREATE TABLE vaccine (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    pet_id BIGINT,
    vaccination_time TIMESTAMP(6),
    vaccine_name VARCHAR(255),
    PRIMARY KEY (id)
);

-- Foreign Key Constraints
ALTER TABLE IF EXISTS pet 
    ADD CONSTRAINT FK_pet_owner FOREIGN KEY (owner_id) REFERENCES owner;

ALTER TABLE IF EXISTS user_roles 
    ADD CONSTRAINT FK_user_roles_role FOREIGN KEY (role_id) REFERENCES roles;

ALTER TABLE IF EXISTS user_roles 
    ADD CONSTRAINT FK_user_roles_user FOREIGN KEY (user_id) REFERENCES app_user;

ALTER TABLE IF EXISTS vaccine 
    ADD CONSTRAINT FK_vaccine_pet
    FOREIGN KEY (pet_id) REFERENCES pet(id)
    ON DELETE CASCADE;
